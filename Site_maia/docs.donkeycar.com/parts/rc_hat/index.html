<!DOCTYPE html>
<html class="writer-html5" lang="en" >

<!-- Mirrored from docs.donkeycar.com/parts/rc_hat/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Nov 2022 13:16:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>RC Hat - Donkey Car</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "RC Hat";
        var mkdocs_page_input_path = "parts/rc_hat.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="../../../cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../index.html" class="icon icon-home"> Donkey Car
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/build_hardware/index.html">Build a car.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/install_software/index.html">Install the software.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/create_application/index.html">Create Donkeycar App.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/calibrate/index.html">Calibrate steering and throttle.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/get_driving/index.html">Get driving.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/train_autopilot/index.html">Train an autopilot.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/ui/index.html">Donkey UI.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/simulator/index.html">Donkey Simulator.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/virtual_race_league/index.html">Virtual Race League.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/mobile_app/index.html">Mobile app</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Parts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../actuators/index.html">Actuators</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../controllers/index.html">Controllers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../odometry/index.html">Odometry/encoders</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rc/index.html">RC</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="index.html">RC Hat</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#install-pigpio">Install PiGPIO</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reading-rc-controller-with-rc-hat">Reading RC Controller with RC Hat</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#controlling-esc-and-steering-servo-with-rc-hat">Controlling ESC and Steering Servo with RC Hat</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#calibration">Calibration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#oled-setup">OLED setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#showing-your-ip-address-on-startup">Showing your IP address on startup.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#troubleshooting_1">Troubleshooting</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#encoder">Encoder</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../keras/index.html">Keras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stores/index.html">Stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fastai/index.html">Fastai</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../imu/index.html">IMU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lidar/index.html">Lidar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oled/index.html">OLED</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pins/index.html">Pins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voice_control/index.html">Voice Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stop_sign_detection/index.html">Stop Sign Detection</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/donkey/index.html">donkey</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/ui/index.html">UI</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/contribute/index.html">Contribute</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/tests/index.html">Tests</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/model/index.html">Create your own model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cars</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/supported_cars/index.html">Supported Cars</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/roll_your_own/index.html">Roll Your Own</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/faq/index.html">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/legacy/index.html">Legacy</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Donkey Car</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Parts &raquo;</li>
      <li>RC Hat</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/autorope/donkeydocs/edit/master/docs/parts/rc_hat.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="donkeycar-rc-hat">Donkeycar RC Hat</h1>
<p><img alt="RC Hat for RaspberryPi" src="../../assets/rc_hat.jpg" title="The Donkey RC Hat for RaspberryPi" /></p>
<p>If you started with a ready-to-run RC car, it probably came with a RC controller. Good news: you can use it with Donkeycar, using the RC controller for manual driving. You can also plug in the car's servo and motor controller directly into the RaspberryPi without the need for a PCA9685 motor/servo controller board. </p>
<p>Note that you will want your RC controller to be well trimmed prior to using it with the RC hat.  You want the throttle trim, steering trim and steering range to be well adjusted; see this <a href="https://www.youtube.com/watch?v=NuVQz7FCAZk">video</a> for how to do that.</p>
<p>To do so, you can either wire up it up manually as shown in <a href="../rc/index.html">this tutorial</a> (which works, but has a lot of fiddly wires that can fall off) or do it far more neatly with the Donkeycar RC hat, shown above, which handles all the wiring for you, along with including an OLED screen and a fan. </p>
<p>The Donkeycar RC hat can be purchased from the <a href="https://store.donkeycar.com/products/donkey-car-rc-hat">Donkeycar Store</a>. Note that it only works with the RaspberryPi, not the Jetson Nano, due to limitations with the way the Jetson handles its I/O pins. </p>
<p>If you're using a standard <a href="../odometry/index.html">wheel encoder</a>, you can plug it into the "Encoder" pins. You can also power the RaspberryPi from this board if you have a 5V source with the "Optional 5v power in" pins</p>
<p>Once you've plugged in all the cables, you can move to the software setup</p>
<p>There are two parts to the software setup.  The first part is setting up to read the RC Controller using the RC Hat.  The Second, optional, part is setting up the drive train so we can control the ESC and SERVO using the RC hat (so you don't need a PCA9685 anymore)/</p>
<h2 id="install-pigpio">Install PiGPIO</h2>
<p>In both cases we are going to use the PiGPIO library to control the I/O pins (remember, this only works on a RaspberryPi).  Install PiGPIO from a command prompt as follows;</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install pigpio
</code></pre>
<p>Then, on the command line enter this to set the PIGPIO daemon to always run on startup:</p>
<pre><code class="language-bash">sudo systemctl enable pigpiod &amp; sudo systemctl start pigpiod
</code></pre>
<h2 id="reading-rc-controller-with-rc-hat">Reading RC Controller with RC Hat</h2>
<p>The RC Hat can route the PWM signals generated by your RC Receiver to the RaspberryPi's gpio pins, so software can measure the length of the PWM pulse and then use that to determine steering and throttle.  This allows you to use the RC controller that came with your RC rather than using a game controller.</p>
<p><strong>Connection:</strong>
To use the RC hat to read your RC controller, use the included 3-wire cables to connect your RC receiver to the RC 1 and RC 2 pins (corresponding to the RC receiver's Channel 1 and Channel 2). In all cases, make sure you plug them in the right way, noting the +,- and S (Signal) markings. Typically the black wire is "-", the red wire in the middle is "+" and the white wire is "S". </p>
<p><strong>Configuration:</strong>
Now edit your myconfig.py file to use the RC Hat to read the RC Controller. In your <code>mycar</code> directory, edit the myconfig.py files as follows:</p>
<p>Use <code>pigpio_rc</code> as your controller type in your myconfig.py file. Uncomment the <code>CONTROLLER_TYPE</code> line (remove the leading <code>#</code>) and edit it as follows:</p>
<pre><code class="language-python">CONTROLLER_TYPE = 'pigpio_rc'
</code></pre>
<p>Also set <code>use joystick</code> to True</p>
<pre><code class="language-python">USE_JOYSTICK_AS_DEFAULT = True
</code></pre>
<p>There are additional settings you can change in the <code>#PIGPIO RC control</code> section, such as reversing the direction of output or the pins connected, or adjusting the expect PWM pulse width (see <a href="../actuators/index.html#standard-rc-with-esc-and-steering-servo">Standard RC with ESC and Steering Servo</a> for a discussion of Pulse Width Modulation); TLDR - a 1000 nanosecond pulse means full left/reverse, a 1500 nano second pulse means straight/stopped and a 2000 nanosecond pulse means full right/forward.  The defaults are generally good and you can start with them.  If you see any issues when calibrating then read the <code>Troubleshooting</code> section to see how you might change one or more of these values to compensate.</p>
<p>Input options for reading RC controller:</p>
<pre><code class="language-python">#PIGPIO RC control
STEERING_RC_GPIO = 26              # gpio pin (in broadcom numbering) for reading the RC controller's steering
THROTTLE_RC_GPIO = 20              # gpio pin (in broadcom numbering) for reading the RC Controller's throttle
DATA_WIPER_RC_GPIO = 19            # gpio pin (in broadcom numbering) for reading the RC Controller's button
PIGPIO_STEERING_MID = 1500         # PWM pulse in nanoseconds for 'straight` steering.  Adjust this value if your car cannot run in a straight line.
PIGPIO_MAX_FORWARD = 2000          # PWM pulse in nanoseconds for max forward throttle.
PIGPIO_STOPPED_PWM = 1500          # PWM pulse in nanoseconds for zero throttle
PIGPIO_MAX_REVERSE = 1000          # PWM pulse in nanoseconds for max reverse throttle. 
PIGPIO_SHOW_STEERING_VALUE = False
PIGPIO_INVERT = False              # rarely a controller uses an inverted pulse; if so then set to True
PIGPIO_JITTER = 0.025              # threshold below which no signal is reported (debounce/noise rejection)
</code></pre>
<h2 id="controlling-esc-and-steering-servo-with-rc-hat">Controlling ESC and Steering Servo with RC Hat</h2>
<p>Optionally, you can use the RaspberryPi to generate PWM (see <a href="../actuators/index.html#standard-rc-with-esc-and-steering-servo">Standard RC with ESC and Steering Servo</a>) for controlling the motor speed and steering rather than using a PCA9685 board (there, see you just paid for the RC Hat!).  </p>
<p><strong>Connection:</strong>
The RC hat includes two 3-pin headers compatible with the servo cables that connect to the ESC and the steering servo.  Plug your car's servo into the Servo pins and the Motor Controller into the Motor pins. In all cases, make sure you plug them in the right way, noting the +,- and S (Signal) markings. Typically the black wire is "-", the red wire in the middle is "+" and the white wire is "S". </p>
<p><strong>Configuration:</strong>
For RC output, select <code>PWM_STEERING_THROTTLE</code> as your drive train type in your myconfig.py file. Uncomment the <code>DRIVE_TRAIN_TYPE</code> line (remove the leading <code>#</code>) and edit it as follows:</p>
<pre><code class="language-python">DRIVE_TRAIN_TYPE =  &quot;PWM_STEERING_THROTTLE&quot;
</code></pre>
<p>Then uncomment the entire <code>PWM_STEERING_THROTTLE</code> configuration block and make sure steering uses <code>"PIGPIO.BCM.13"</code> and throttle uses <code>"PIGPIO.BCM.18"</code> because that is how the pins on the RC Hat are connected to the RaspberryPi 40 pin header.</p>
<pre><code class="language-python">PWM_STEERING_THROTTLE = {
    &quot;PWM_STEERING_PIN&quot;: &quot;PIGPIO.BCM.13&quot;,    # PWM output pin for steering servo
    &quot;PWM_STEERING_SCALE&quot;: 1.0,              # used to compensate for PWM frequency differents from 60hz; NOT for adjusting steering range
    &quot;PWM_STEERING_INVERTED&quot;: False,         # True if hardware requires an inverted PWM pulse
    &quot;PWM_THROTTLE_PIN&quot;: &quot;PIGPIO.BCM.18&quot;,    # PWM output pin for ESC
    &quot;PWM_THROTTLE_SCALE&quot;: 1.0,              # used to compensate for PWM frequence differences from 60hz; NOT for increasing/limiting speed
    &quot;PWM_THROTTLE_INVERTED&quot;: False,         # True if hardware requires an inverted PWM pulse
    &quot;STEERING_LEFT_PWM&quot;: 460,               #pwm value for full left steering
    &quot;STEERING_RIGHT_PWM&quot;: 290,              #pwm value for full right steering
    &quot;THROTTLE_FORWARD_PWM&quot;: 500,            #pwm value for max forward throttle
    &quot;THROTTLE_STOPPED_PWM&quot;: 370,            #pwm value for no movement
    &quot;THROTTLE_REVERSE_PWM&quot;: 220,            #pwm value for max reverse throttle
}
</code></pre>
<h2 id="calibration">Calibration</h2>
<p>After configuring the RC hat to read the RC controller and optionally control the ESC and steering servo you should do the normal <a href="../../guide/calibrate/index.html">calibration</a> step to figure out the correct steering and throttle PWM values for your car (and to make sure you've hooked things up correctly).</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>If one channel is reversed (steering left goes right, etc), either reverse that channel on your RC transmitter (that's usually a switch or setting) or change it in the output options shown above by changing the PWM_INVERTED value for that channel to <code>True</code>.</p>
<h2 id="oled-setup">OLED setup</h2>
<p>Enable the display in <code>myconfig.py</code>.</p>
<pre><code class="language-python"># SSD1306_128_32
USE_SSD1306_128_32 = True     # Enable the SSD_1306 OLED Display
SSD1306_128_32_I2C_BUSNUM = 1 # I2C bus number
SSD1306_RESOLUTION = 1 # 1 = 128x32; 2 = 128x64
</code></pre>
<h3 id="showing-your-ip-address-on-startup">Showing your IP address on startup.</h3>
<p>One of the cool things about having an OLED screen is that you can show your car's IP address on startup, so you can connect to it. Instructions to set that up are <a href="https://diyrobocars.com/2021/12/29/show-your-raspberrypi-ip-address-on-startup-with-an-oled/">here</a></p>
<h3 id="troubleshooting_1">Troubleshooting</h3>
<p>If you are unable to start the car, ensure that the <code>Adafruit_SSD1306</code> package is installed in your virtual environment. This should automatically be installed, if you are using a recent version of <code>donkeycar</code>.</p>
<pre><code class="language-bash">pip install Adafruit_SSD1306
</code></pre>
<h2 id="encoder">Encoder</h2>
<p>If you're using a standard <a href="../odometry/index.html">wheel encoder</a>, you can plug it into the "Encoder" pins, then setup the encoder configuration in your myconfig.py to use the pin that is exposed by the RC hat's encoder header.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../rc/index.html" class="btn btn-neutral float-left" title="RC"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../keras/index.html" class="btn btn-neutral float-right" title="Keras">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/autorope/donkeydocs/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../rc/index.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../keras/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../index.html';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>

<!-- Mirrored from docs.donkeycar.com/parts/rc_hat/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Nov 2022 13:16:24 GMT -->
</html>
